@using Microsoft.AspNet.Identity
@model CCM.Models.Patient
@using CCM.Helpers
@using CCM.Models.CCMBILLINGS
@{
    List<int> EnrolledIn = new List<int>();
    var PreTranslater = ViewBag.PreTranslater;
    var PreLiaison = ViewBag.PreLiaison;
    List<string> counselornames = (List<string>)ViewBag.Counselors;
}
<script src="~/Scripts/RecordActivity.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.14/jquery.datetimepicker.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.9.1/sweetalert2.css">
@*<link rel="stylesheet" href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" type="text/css" />*@
<link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" type="text/css" rel="stylesheet" />
<link href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css" type="text/css" rel="stylesheet" />
<link href="~/Content/PatientDeatil/ProgressBar.css" rel="stylesheet" />
<script>


</script>
<style>
    .hLine {
        margin-top: 5px;
    }

    .no-padding {
        padding-left: 0px !important;
        padding-right: 0px !important;
    }

    /*#profile img {
        border: 1px solid;
        padding: 5px;
    }*/

    .tab-content {
        padding: 15px 10px 15px 10px;
        margin: 0px 0 20px 0px;
        box-shadow: 0px 0px 5px #393939;
        border-radius: 0 0 0px;
        background: #ddd;
    }

    .card {
        border-radius: 2px;
        box-shadow: 0 2px 2px rgba(21, 27, 45, 0.85);
        background-color: #fbfbfb59;
        color: #252422;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
        border: 1px solid #242950;
        padding: 5px 0;
    }

    .custom-title {
        background: #22394E;
        margin-bottom: 15px;
        padding: 5px 10px;
    }

        .custom-title h4, .custom-title h3 {
            color: #fff;
            font-weight: 400;
            padding: 0px !important;
            text-transform: uppercase;
            margin: 0px;
            font-size: 20px;
        }

    .pageTitle {
        display: inline;
    }

    .custom-title .fa-caret-down:hover {
        cursor: pointer;
    }

    .nav-tabs > li.active > a, .patient-detail-tabs .nav-tabs > li.active > a:hover, .patient-detail-tabs .nav-tabs > li.active > a:focus {
        /* background: #034b22; */
        background: #034b22;
        background: -moz-linear-gradient(top, #034b22 1%, #1e894c 100%);
        background: -webkit-linear-gradient(top, #034b22 1%,#1e894c 100%);
        background: linear-gradient(to bottom, #034b22 1%,#1e894c 100%);
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#034b22', endColorstr='#1e894c',GradientType=0 );
        color: #fff;
    }

    .inner-heading {
        font-size: 1.35em;
        font-weight: bold;
        /* padding: 10px 0; */
        color: #74B34A;
    }

        .inner-heading h4 {
            margin-top: 0px !important;
        }

    label.error {
        color: red;
    }

    .navbar-fixed-top {
        height: 74px;
    }

    .sidebar .nav, .off-canvas-sidebar .nav {
        margin-top: 28px;
    }

    .noShadow {
        box-shadow: none !important;
    }
    /*. nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
        cursor: default;
        background-color: #fff;
        border: 1px solid #ddd;
        border-bottom-color: transparent;
    }*/
    #imgLargeBox {
        min-height: 100vh;
        min-width: 400px;
        height: 100% !important;
        width: 100% !important;
    }

    .OtherCategorySection {
        display: none;
        width: 54%;
        box-shadow: 0px 0px 5px #393939;
        background: #ddd;
        position: relative;
    }

    #hide-OtherCategoies {
        color: #ffffff;
        font-size: 20px;
        position: absolute;
        top: 10px;
        right: 29px;
        z-index: 1;
    }
</style>

@if (Model.EnrollmentStatus == "Enrolled")
{
    <style>
        .enrollmentStatus {
            cursor: not-allowed;
        }

        .ddlEnrollmentStatus {
            pointer-events: none;
        }
        /*.fixedElement {
            background-color: #ffffff;
            position: sticky;
            top: 76px;
            width: 100%;
            z-index: 1;
        }*/


    </style>
}
@*<div class="fixedElement">*@
<div class="uperareafix">
    <input type="hidden" id="ViewNarrative" />
    <input type="hidden" id="HideDataforCallRecive" value="@ViewBag.HideDataForCallReceive" />
    @if (ViewBag.HideDataForCallReceive == "Yes")
    {
        <label class="dontclosemsg">Don't close this window until you are in the call otherwise you would not be able to open it again.</label>
    }
    <div id="profile" class="row card">

        <div class="col-md-1">
            @if (Model.Photo != null)
            {
                <img src="@Url.Action("DisplayImage", "Patient", new { patientId = Model.Id, imageName = "photo" })" height="75" width="75" alt="" /> }
            else
            {
                if (Model.Gender == "Male" || Model.Gender == "" || Model.Gender == null)
                {
                    <img src="~/dashboard/assets/img/faces/patient.jpg" height="75" width="75" alt="" />
                }
                else
                {
                    <img src="~/dashboard/assets/img/faces/patientfemale.png" height="75" width="75" alt="" />
                }
            }
        </div>

        <div class="col-md-2">
            @{
                var age = (int.Parse(DateTime.Today.ToString("yyyyMMdd")) - int.Parse(Model.BirthDate.ToString("yyyyMMdd"))) / 10000;
                var ageStatus = Model.EnrollmentStatus == "Deceased" ? "Deceased" : age + " Years";
                var color = ageStatus == "Deceased" ? "red" : "";
                var cycle = CategoryCycleStatusHelper.GetPatientNewOrOldCycleByCategory(Model.Id, BillingCodeHelper.cmmBillingCatagoryid);
                //var ccmcyclestatus = HelperExtensions.GetCCMCycleStatus(Model.Id, cycle, User.Identity.GetUserId());
            }
            <p>
                <b>Name:</b>   @Model.LastName, @Model.FirstName
                <br />
                <b>DOB:</b>    @Model.BirthDate.ToString("MM/dd/yyyy")
                <span style="color: @color; font-size: 90%">(@ageStatus)</span>
                <br />
                <b>Gender:</b> @Model.Gender
                <br />
                <span class="text-info"><b>Current Cycle:</b> @cycle</span>
                <input type="hidden" id="lblgender" value="@Model.Gender" />
            </p>
        </div>

        <div class="col-md-2">
            @{
                //var status  = Model.EnrollmentStatus == "Enrolled" ? Model.CcmStatus : Model.EnrollmentStatus;
                //var status = ccmcyclestatus;
                //var substatus = Model.EnrollmentSubStatus;
                //if(substatus != "" && substatus !=null)
                //{
                //    status = status + " (" + substatus + ")";
                //}

                //  var liaison = Model.Liaison != null ? Model.Liaison.FirstName : "Not Assigned";
                var liaison = "";
                if (PreLiaison != null)
                {
                    liaison = PreLiaison.FirstName;
                }


            }
            <p>
                <b>Current Cycle Status:</b> @*@status*@ @ViewBag.ccmcyclestatus
                <br />
                <b>Counselor:</b>
                @if (counselornames.Count > 0)
                {
                    <select class="notRecord">

                        @foreach (var item in counselornames)
                        {
                            <option class="notRecord"> @item</option>
                        }

                    </select>
                }
                else if (ViewBag.PreCounsolerName != null)
                {

                    <select class="notRecord">

                        <option class="notRecord"> @ViewBag.PreCounsolerName</option>
                    </select>
                }
                else if (ViewBag.PreCounsolerName == null && counselornames.Count == 0)
                {
                    liaison = "Not Assigned";
                    @liaison
                }

                <br />
                <b>Physician:</b> Dr. @Model.Physician.LastName
            </p>
        </div>

        <div class="col-md-7 text-center">
            <div class="col-md-7">
                @if (!User.IsInRole("Sales"))
                {
                    <a class="btn btn-success pull-left linkButtons noShadow" id="careplan" style="margin-right:5px;" onclick="AjaxRefresh('FinalCarePlanNotes','_Index',@(Model.Id),'finalcare')">Final Care Plan</a>
                    @*<a class="btn btn-success pull-left linkButtons" id="careplan" style="margin-right:5px;">Final Care Plan</a>*@

                    <a class="btn btn-success pull-left noShadow linkButtons" href="/FinalCarePlan/GenerateFinalCarePdf?patientId=@Model.Id" target="_blank">Care Plan PDF</a>
                }
                <a class="btn btn-success pull-left linkButtons noShadow" id="notesmodal" style="margin-right:5px;margin-left:5px;" onclick="Shownotesmodal()"><i class="fa fa-commenting" aria-hidden="true" title="Add Notes"></i></a>
                @if (!User.IsInRole("Sales"))
                {
                    <a class="btn btn-success pull-left linkButtons NarrativeToggle noShadow" style="margin-right:10px;" role="button" aria-expanded="false" title="Show/Hide Narrative" onclick="showhidenarratives()"><i class="fa fa-sort" aria-hidden="true"></i>Narrative/Surveys</a>
                }
                <a class="btn btn-success pull-left linkButtons noShadow" style="margin-right:10px;" role="button" aria-expanded="true" title="Show/Hide Notes" onclick="showhidenotes()"><i class="fa fa-toggle-on" aria-hidden="true"></i></a>

            </div>
            <div class="col-md-5" id="progressBarDiv" style="display:none">

                @foreach (var item in ViewBag.EnrolledCcmCategories as List<BillingCategory>)
                {
                    EnrolledIn.Add(item.BillingCategoryId);
                    <div class="row">
                        <h6 class="progressPercentage" id="@("progressPercentage"+item.BillingCategoryId)">0%</h6>
                        <div class="meter">
                            <span class="meterspan" id="@("BillingProgress"+item.BillingCategoryId)" style="width:0%"></span>
                            <p>@item.Name</p>
                        </div>
                    </div>
                    <input type="hidden" id="@("BillingCategoryHiddenForProgressBar"+item.BillingCategoryId)" value="@item.MinimunMinutes" />

                }


            </div>
        </div>
    </div>

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" style="margin:0 0 10px 0; display:none">
        Hide / Show Tabs
    </button>
    <div class="tabs-list patient-detail-tabs">
        @*<a class="btn btn-success linkButtons" onclick="AjaxRefresh1('Patient','_Details',@(Model.Id),'')"> Patient Details</a>*@
        <div class="main-tabs-sticky">
            <ul class="nav nav-tabs custom-tabs">
                <li class="hvr-float-shadow custom-nav-item active" id="patient-detail">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh1('Patient','_Details',@(Model.Id),'')" data-toggle="tab"> Patient Details</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="patient-notes">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('Patient','PatientNotes',@(Model.Id),'Patient Notes')" data-toggle="tab"> Patient Notes</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="bookAppointment">
                    <a onclick="showappointmentpopup(@(Model.Id),this)" data-id="CCM" class=" nav-link logdetails selectMenuTab">Book Appointment</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="doctorVisit">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('DoctorVisit','_DoctorVisitAndAditionalProvider',@(Model.Id),'Doc Visit /Add Provider')">  Doc Visits / Add Providers</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="patientConsent">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientProfile','_PatientProfileConsent',@(Model.Id),'Patient Consent')">  Patient Consent</a>
                </li>
                @*<li class="hvr-float-shadow custom-nav-item" id="doctorVisit">
                        <a class=" nav-link" onclick="AjaxRefresh('DoctorVisit','_ListDoctorVisits',@(Model.Id),this)">  Doctor Visits</a>
                    </li>*@
                <li class="hvr-float-shadow custom-nav-item" id="elig">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientMeidcareMedicaidEligibilities','_Create',@(Model.Id),'Eligibility')"> Eligibility</a>
                </li>
                @*<li class="hvr-float-shadow custom-nav-item" id="additionalP">
                        <a class=" nav-link" onclick="AjaxRefresh('SecondaryDoctor','_Index',@(Model.Id),this)">  Additional Providers</a>
                    </li>*@
                @*<li class="hvr-float-shadow custom-nav-item" id="patient-detail">
                        <a class=" nav-link active" onclick="AjaxRefresh('FinalCarePlanNotes','_Index',@(Model.Id))"> Final Care Plan</a>
                    </li>*@
                <li class="hvr-float-shadow custom-nav-item" id="reviewT">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefreshReview('CcmStatus','_ReviewTimeV1',@(Model.Id),@(Model.Cycle))"> Review Encounter</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="diagnosis">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('Icd','_Index',@(Model.Id),'Diagnosis')"> Diagnosis</a>
                </li>

                <li class="hvr-float-shadow custom-nav-item" id="conP">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientProfile','_ContactPreferences',@(Model.Id),'Contact Prefrences')"> Contact Preferences</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="medical">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientMedicalStatus','_MedicalHistory',@(Model.Id),'Medical History')"> Medical History</a>
                </li>


                <li class="hvr-float-shadow custom-nav-item" id="Laboratory">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientProfile','LaboratoryResult',@(Model.Id),'Laboratory Results')">Laboratory Results</a>
                </li>
                <li class="hvr-float-shadow custom-nav-item" id="lifeS">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientLifestyle_DietAndHabit','_LifeStyleAndHabits',@(Model.Id),' Lifestyle & Habits')"> Lifestyle & Habits</a>
                </li>
                @if (!User.IsInRole("Sales"))
                {
                    <li class="hvr-float-shadow custom-nav-item" id="Sharecareplanli">
                        <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh1('Patient','_ShareCarePlanView',@(Model.Id),' Share CarePlan')"> Share CarePlan</a>
                    </li>
                }
                <li class="hvr-float-shadow custom-nav-item" id="Sharecareplanli">
                    <a class=" nav-link logdetails selectMenuTab" data-id="CCM" onclick="AjaxRefresh('PatientProfile','_PatientProfile_HospitalVisit',@(Model.Id),'Hospital Visits')"> Hospital Visits</a>
                </li>
                @foreach (var item in ViewBag.EnrolledCcmCategories as List<BillingCategory>)
                {
                    if (item.Name.ToLower() != "ccm")
                    {
                        @*<li class="hvr-float-shadow custom-nav-item" id="Sharecareplanli">
                                <a class="selectMenuTab nav-link @("BillingCategoryactivityRecord"+item.BillingCategoryId)" data-id="@item.Name" data-value="@item.BillingCategoryId" onclick="AjaxRefresh('PatientProfile','_PatientEnrollmentCategories','@(Model.Id + "-" + item.Name)','Enrollment Categories')"> @item.Name</a>
                            </li>*@

                        if (item.Name.ToLower() == "g0506 initial visit")
                        {
                            <li class="hvr-float-shadow custom-nav-item" id="Sharecareplanli">
                                <a class="selectMenuTab OtherBillingCategoryTab nav-link @("BillingCategoryactivityRecord"+item.BillingCategoryId)" data-id="@item.Name" data-value="@item.BillingCategoryId" onclick="AjaxRefresh('G0506','Index','@(Model.Id)','G0506 INITIAL VISIT')"> @item.Name</a>
                            </li>
                        }
                        else if (item.Name.ToLower() == "rpm")
                        {
                            <li class="hvr-float-shadow custom-nav-item" id="Sharecareplanli">
                                <a class="selectMenuTab  nav-link @("BillingCategoryactivityRecord"+item.BillingCategoryId)" data-id="@item.Name" data-value="@item.BillingCategoryId" onclick="AjaxRefresh('Rpm','Index','@(Model.Id)','RPM')"> @item.Name</a>
                            </li>
                            <li class="hvr-float-shadow custom-nav-item" id="Sharecareplanli">
                                <a class="selectMenuTab commingSoonAlert  nav-link @("BillingCategoryactivityRecord"+item.BillingCategoryId)" @*data-id="@item.Name" data-value="@item.BillingCategoryId"*@ @*onclick="AjaxRefresh('Rpm','Index','@(Model.Id)','RPM')"*@> Devices Configuration</a>
                            </li>
                        }
                    }
                }
                @*Drop down list tabbing*@
            </ul>
        </div>
    </div>
    <div class="importantnotes expand-section" id="importantnotes"></div>
</div>
@*</div>*@
<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle" style="display:inline-block;">Hide And Show Tabs</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">

                <!-- <label for="Patient">
                    <input type="checkbox" id="Patient" />
                    Patient Detail
                </label> -->

                <label for="doctor-v">
                    <input type="checkbox" id="doctor-v" class="checkboxes">
                    Doctor Visits
                </label>
                <label for="chkbookappoinment">
                    <input type="checkbox" id="chkbookappoinment" class="checkboxes">
                    Book Appoinment
                </label>
                <label for="patientConsent-v">
                    <input type="checkbox" id="patientConsent-v" class="checkboxes">
                    Patient Consent
                </label>
                <label for="eligBox">
                    <input type="checkbox" id="eligBox" class="checkboxes">
                    Eligibility
                </label>
                <label for="addp">
                    <input type="checkbox" id="addp" class="checkboxes">
                    Aditional Providers
                </label>
                <label for="review">
                    <input type="checkbox" id="review" class="checkboxes">
                    Review Time
                </label>
                <label for="chkDiagnosis">
                    <input type="checkbox" id="chkDiagnosis" class="checkboxes">
                    Diagnosis
                </label>
                <label for="con">
                    <input type="checkbox" id="con" class="checkboxes">
                    Contact Preferences
                </label>
                <label for="med">
                    <input type="checkbox" id="med" class="checkboxes">
                    Medical History
                </label>
                <label for="life">
                    <input type="checkbox" id="life" class="checkboxes">
                    Life Style &amp; Habits
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" id="imgbox" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:85%;height:90%;margin:0 auto;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <img src="#" id="imgLargeBox" />
            </div>
        </div>
    </div>
</div>

<div class="NarrativeSurvey expand-section" id="NarrativeSurvey"></div>
<div class="patient-main-wraper">
    <div class="row">
        <input type="hidden" id="forsharecareplan" value="@ViewBag.ForCareplan" />
        <input type="hidden" id="sharecareplancycle" value="@ViewBag.CycleforCarePlan" />
        <div class="col-md-7 full-width" id="patient-detail-wraper" style="padding-left:0px;float:left;margin-right:0px;padding-right:0px">
            @Html.Action("_CcmActivityLinks", "CcmStatus", new { patientId = Model.Id })
            <input type="hidden" id="patientidh" value="@Model.Id" />

            <div id="MultiLinksPartialViews" class="table-responsive" style="display:none;width:100%;"></div>

            <div class="tab-content" style="position: relative; z-index: 0;width:100%;" id="patientDetails">
                <div id="partialviewsdata">
                    @*@Html.Partial("_Details?id=")*@
                    <script>
                        $(".loader").show();
                        @{ string actionname = "_Details";}
                        @if (ViewBag.ForCarePlan == true)
                        {
                            actionname = "_ShareCarePlanView";
                        }

                         AjaxRefresh1('Patient', '@actionname',@(Model.Id), '')
                    </script>
                </div>
            </div>
        </div>

        <!--Final Care Plan  Design-->
        <div class="col-md-5 care-plan-section" id="care_plan" style=" float: right;  display: none;">
            <a class="btn btn-success btn-lg logdetails" id="CreatCarePlan" style="margin-top:15px;" onclick="AjaxRefresh('FinalCarePlanNotes','_Create',@(Model.Id),'Final Care Plan')">Create</a>
            <i class="fas fa-backward close-btn" id="refresh-carePlan" style="right:45px;cursor:pointer"></i>
            <i class="fas fa-close close-btn" id="hide-carePlan"></i>
            <div id="LoadFinalCarePlan"></div>
        </div>

        <div class="col-md-5 OtherCategorySection" id="OtherBillingCategoryDiv" style=" float: right; display: none;">
            <i class="fas fa-close close-btn" id="hide-OtherCategoies"></i>
            <div id="LoadOtherBillingCategoryDiv"></div>
        </div>
        <!--ENd Final Care Plan  Design-->
    </div>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryui")
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.14/jquery.datetimepicker.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.9.1/sweetalert2.js"></script>
    @*<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>*@
    @*<script src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js" type="text/javascript"></script>*@
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/colreorder/1.5.1/js/dataTables.colReorder.min.js" type="text/javascript"></script>
    @* Load Partial Views & DateTime Picker function *@


    @* Record CCM Review Encounter *@
    @if (User.IsInRole("Liaison"))
    {
        <SCRIPT type="text/javascript">


            function reviewTimePost() {

            }
        </SCRIPT>
    }

    <script>
        var patientphone = '@Model.MobilePhoneNumber';
            var patientEmail = '@Model.Email';
            var patientidstr = '@HelperExtensions.Encrypt(Model.Id.ToString())';
        function opensignaturesendlinkmodal() {
            $("#PatientPhoneNumber").val(patientphone);
            $("#PatientEmail").val(patientEmail);
            $("#PatientConsentSendLinkModal").modal("show");
        }
        function sendlinktophone() {
            if (!$("#PatientPhoneNumber").val())
                    alert("Error: Patient phone number is required.");
                else {

                $(".loader").show();
                    $.ajax({
                        url: "/ContactPatient/SendSignatureLink",
                        type: "POST",
                        data: {
                            'patientId': @Model.Id,
                            'phoneNumber': $("#PatientPhoneNumber").val(),
                            'messageBody': window.location.origin + "/PatientSignature/Index?patientIdstr=" + patientidstr
                        },

                        success: function (result) {
                            if (result == "True") {
                                $("#PatientConsentSendLinkModal").modal("hide");
                                swal("Successfully sent link to patient for signature on phone number.")
                            }
                            else {
                                swal(result);
                            }
                            $(".loader").hide();
                        },
                        error: function (result) {
                            $(".loader").hide();
                            alert(result.responseText);
                        }

                    });
                }
        }
        function sendlinktoemail() {
            if (!$("#PatientEmail").val())
                    alert("Error: Patient email is required.");
                else {
                $(".loader").show();

                    $.ajax({
                        url: "/ContactPatient/SendSignatureLinkEmail",
                        type: "POST",
                        data: {
                            'patientId': @Model.Id,
                            'Emailaddress': $("#PatientEmail").val(),
                            'messageBody': window.location.origin + "/PatientSignature/Index?patientIdstr=" + patientidstr
                        },

                        success: function (result) {
                            $(".loader").hide();
                            if (result == "True") {
                                $("#PatientConsentSendLinkModal").modal("hide");
                                swal("Successfully sent link to patient for signature on email.")
                            }
                            else {
                                $(".loader").hide();
                                swal(result);
                            }
                        },
                        error: function(result) {
                            alert(result.responseText);
                        }

                    });
                }
        }
        $(document).ready(function () {
               $(document).ready(function () {
                   $("#SelectedCategory").val('CCM');
                   //alert($("#SelectedCategory").val());
                   $("#PreviousCategory").val('CCM');
                   $("#ReviewId"+@BillingCodeHelper.cmmBillingCatagoryid).val('@ViewBag.ReviewIdCCM');

        $('#SelectedCategory').data('id',0);
        $('#SelectedCategory').data('value',0);
                   $('#PreviousCategory').data('id',0);
                   $('#PreviousCategory').data('value',0);

    })

            var urlParams = new URLSearchParams(location.search);
            var _myQueryString = urlParams.get('ViewNarrative');
            $("#ViewNarrative").val(_myQueryString)

            if ($("#HideDataforCallRecive").val() == "Yes") {
                $(".navbar-fixed-top").css({ "display": "none" });
                $("#sidebar").css("display", "none");
                $("html, body").css("margin-left", "0");
                $(".uperareafix").css("top", "0");
                $(".body-content").css("margin-top", "0");
            }
               var patientid=@Model.Id;
            var error = '@ViewBag.Msg';
            if (error != "") {
                //swal(error);
                //alert(error);
                //window.location = "/Patient/Details/" + patientid;
                swal({
                    title: 'Error',
                    text: error,
                    type: 'info',
                    showCancelButton: false,
                    allowOutsideClick: false,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'ok',

                    //allowOutsideClick: false,
                    //showLoaderOnConfirm: false
                }).then(function () {
                    window.location = "/Patient/Details/" + patientid;
                    //debugger;
                });
            }
            $("#currentcontroller").val('Patient Details');
            UpdateTimerOtherCategory();
            UpdateProgressbar();





        });

        var UpdateTimerOtherCategory = function () {
            debugger;
                var otherCategoryPreviousTime;
                var PreviousWorkTimeProgressOther = '00:00:00';
                      var data =@Html.Raw(Json.Encode(EnrolledIn));
                data.forEach(item => {

                    if (item != '@BillingCodeHelper.cmmBillingCatagoryid') {
                        if (item == '@BillingCodeHelper.G0506BillingCatagoryid') {
                                $.ajax({
                    type: "GET",
                    url: "/G0506/TotalReviewTimeG0506?patientId=" + '@Model.Id',
                                    success: function (timespan) {
                                        if (timespan != "00:00:00") {

                                            var totalTime = timespan.substr(0, timespan.indexOf('.'));

                                            PreviousWorkTimeProgressOther = totalTime
                                            PreviousWorkTimeProgressOther = toSeconds(PreviousWorkTimeProgressOther);
                                            var TotalTimePercentage = ((PreviousWorkTimeProgressOther) / ((Number($("#BillingCategoryHiddenForProgressBar" + item).val())) * 60)) * 100;
                                            TotalTimePercentage = Number(TotalTimePercentage);
                                            if (TotalTimePercentage > 100) {
                                                TotalTimePercentage = 100;
                                            }
                                            $("#BillingProgress" + item).css("width", TotalTimePercentage + "%");
                                            $("#progressPercentage" + item).text(Math.round(TotalTimePercentage) + "%");
                                            $("#progressBarDiv").css("display", "block");
                                        } else {
                                            $("#BillingProgress" + item).css("width","0%");
                                            $("#progressPercentage" + item).text("0%");
                                            $("#progressBarDiv").css("display", "block");
                                        }
                    }
                            });


                        }
                    }
                })
            }



        function toSeconds(s) {
            var p = s.split(':');
            return parseInt(p[0], 10) * 3600 + parseInt(p[1], 10) * 60 + parseInt(p[2], 10);
        }
        var UpdateProgressbar = () => {

            var currentWorkTimeProgress = toSeconds($("#time").children().text());
            var PreviousWorkTimeProgress = toSeconds($("#totalReviewTime").text());
            var data =@Html.Raw(Json.Encode(EnrolledIn));
            data.forEach(item => {
                var CcmId = '@BillingCodeHelper.cmmBillingCatagoryid';
                if (item == CcmId) {
                    var TotalTimePercentage = ((currentWorkTimeProgress + PreviousWorkTimeProgress) / ((Number($("#BillingCategoryHiddenForProgressBar" + item).val())) * 60)) * 100;

                    TotalTimePercentage = Number(TotalTimePercentage);
                    if (TotalTimePercentage > 100) {
                        TotalTimePercentage = 100;
                    }
                    $("#BillingProgress" + item).css("width", TotalTimePercentage + "%");
                    $("#progressPercentage" + item).text(Math.round(TotalTimePercentage) + "%");
                    $("#progressBarDiv").css("display", "block");
                }
                })

            setTimeout(function () { UpdateProgressbar() }, 1000);
        }
        function callHistory(history) {
            var a = history;
            if (history == 'call') {
                $("#text").removeClass("in active");
                $("#call").addClass("in active");
                $("#email").removeClass("in active");
            }
            else if (history == 'text') {
                $("#text").addClass("in active");
                $("#call").removeClass("in active");
                $("#email").removeClass("in active");
            }
            else if (history == 'email') {
                $("#text").removeClass("in active");
                $("#call").removeClass("in active");
                $("#email").addClass("in active");
            }
            else {
                $("#text").removeClass("in active");
                $("#call").addClass("in active");
                $("#email").removeClass("in active");
            }
        }
        const ShowHideDeEnrollmentDiv = id => {
            debugger;
        if (($("#billingCategoryCheckBox" + id).data('id')) != null) {
            if ($("#billingCategoryCheckBox" + id).prop("checked") != true) {
                $("#DeEnrollmentStatusDiv" + id).show();
                $("#LiasonTranslatorDiv" + id).hide();

                if ($("#billingCategoryCheckBox" + id).data('identifier') == "CCM") {
                    $('[data-identifier="G0506 INITIAL VISIT"]').prop("checked", false);
                    $("[data-identifierId='G0506 INITIAL VISIT']").hide();
                    if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                        $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                    } else {
                        $("[data-identifierreason='G0506 INITIAL VISIT']").show();
                    }

                    //----------------
                    $('[data-identifier="RPM"]').prop("checked", false);
                    $("[data-identifierId='RPM']").hide();
                    $("#RpmServices").hide();
                    if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                        $("[data-identifierreason='RPM']").hide();
                    } else {
                        $("[data-identifierreason='RPM']").show();
                    }
                    //----------------

                }

                if ($("#billingCategoryCheckBox" + id).data('identifier') == "G0506 INITIAL VISIT") {
                    $('[data-identifier="CCM"]').prop("checked", false);
                    $("[data-identifierId='CCM']").hide();
                    $("[data-identifierreason='CCM']").show();
                    if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                        $("[data-identifierreason='CCM']").hide();
                    } else {
                        $("[data-identifierreason='CCM']").show();
                    }

                    //--------RPM--------
                    $('[data-identifier="RPM"]').prop("checked", false);
                    $("[data-identifierId='RPM']").hide();
                    $("#RpmServices").hide();
                    if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                        $("[data-identifierreason='RPM']").hide();
                    } else {
                        $("[data-identifierreason='RPM']").show();
                    }
                    //----------------
                }

                if ($("#billingCategoryCheckBox" + id).data('identifier') == "RPM") {
                    $("#RpmServices").hide();
                }
            }

            else {

                $("#DeEnrollmentStatusDiv" + id).hide();
                $("#LiasonTranslatorDiv" + id).show();


                if ($("#billingCategoryCheckBox" + id).data('identifier') == "CCM") {
                    $('[data-identifier="G0506 INITIAL VISIT"]').prop("checked", true);
                    $("[data-identifierId='G0506 INITIAL VISIT']").show();
                    if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                        $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                    }
                }

                if ($("#billingCategoryCheckBox" + id).data('identifier') == "G0506 INITIAL VISIT") {
                    $('[data-identifier="CCM"]').prop("checked", true);
                    $("[data-identifierId='CCM']").show();
                    //$("[data-identifierreason='CCM']").show();
                    if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                        $("[data-identifierreason='CCM']").hide();
                    }
                }

                if ($("#billingCategoryCheckBox" + id).data('identifier') == "RPM") {

                    $("#RpmServices").show();

                    //---------------enable CCM-----------
                    $('[data-identifier="CCM"]').prop("checked", true);
                    $("[data-identifierId='CCM']").show();
                    //$("[data-identifierreason='CCM']").show();
                    if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                        $("[data-identifierreason='CCM']").hide();
                    }
                    //---------------enable CCM-----------


                    //---------------enable G0506-----------
                    $('[data-identifier="G0506 INITIAL VISIT"]').prop("checked", true);
                    $("[data-identifierId='G0506 INITIAL VISIT']").show();
                    if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                        $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                    }
                    //---------------enable G0506-----------

                }

            }


        } else {

                 if ($("#billingCategoryCheckBox" + id).prop("checked") == true) {
                     $("#LiasonTranslatorDiv" + id).show();

                       if ($("#billingCategoryCheckBox" + id).data('identifier') == "CCM") {
                    $('[data-identifier="G0506 INITIAL VISIT"]').prop("checked", true);
                           $("[data-identifierId='G0506 INITIAL VISIT']").show();
                           if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                               $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                           } else {
                               $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                           }
                         

                         

                }

                if ($("#billingCategoryCheckBox" + id).data('identifier') == "G0506 INITIAL VISIT") {
                    $('[data-identifier="CCM"]').prop("checked", true);
                    $("[data-identifierId='CCM']").show();
                    if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                        $("[data-identifierreason='CCM']").hide();
                    }
                    else {
                        $("[data-identifierreason='CCM']").hide();

                    }
                     }
                     //here 
                     if ($("#billingCategoryCheckBox" + id).data('identifier') == "RPM") {
                         $("#RpmServices").show();
                         $('[data-identifier="CCM"]').prop("checked", true);
                         $("[data-identifierId='CCM']").show();
                         if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                             $("[data-identifierreason='CCM']").hide();
                         }
                         else {
                             $("[data-identifierreason='CCM']").hide();

                         }
                         $('[data-identifier="G0506 INITIAL VISIT"]').prop("checked", true);
                         $("[data-identifierId='G0506 INITIAL VISIT']").show();
                         if ($("#DeEnrollmentReasonHidden" + id).val() != null) {
                             $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                         } else {
                             $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                         }
                     }

                 } else {


                     $("#LiasonTranslatorDiv" + id).hide();


                     if ($("#billingCategoryCheckBox" + id).data('identifier') == "CCM") {
                         $('[data-identifier="G0506 INITIAL VISIT"]').prop("checked", false);
                         $("[data-identifierId='G0506 INITIAL VISIT']").hide();
                         if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                             $("[data-identifierreason='G0506 INITIAL VISIT']").hide();
                         } else {
                             $("[data-identifierreason='G0506 INITIAL VISIT']").show();
                         }


                         $('[data-identifier="RPM"]').prop("checked", false);
                         $("[data-identifierId='RPM']").hide();
                         $("#RpmServices").hide();
                         if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                             $("[data-identifierreason='RPM']").hide();
                         }
                         else {
                             $("[data-identifierreason='RPM']").show();
                         }
                     }

                     if ($("#billingCategoryCheckBox" + id).data('identifier') == "G0506 INITIAL VISIT") {
                         $('[data-identifier="CCM"]').prop("checked", false);
                         $("[data-identifierId='CCM']").hide();
                         if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                             $("[data-identifierreason='CCM']").hide();
                         }
                         else {
                             $("[data-identifierreason='CCM']").show();
                         }


                         $('[data-identifier="RPM"]').prop("checked", false);
                         $("[data-identifierId='RPM']").hide();
                         $("#RpmServices").hide();
                         if ($("#DeEnrollmentReasonHidden" + id).val() == null) {

                             $("[data-identifierreason='RPM']").hide();
                         }
                         else {
                             $("[data-identifierreason='RPM']").show();
                         }


                     }

                     if ($("#billingCategoryCheckBox" + id).data('identifier') == "RPM") {
                         $("#RpmServices").hide();
                     }

            }
        }




        if ($("#DeEnrollmentReasonHidden" + id).val() != null) {

            if ($("#billingCategoryCheckBox" + id).prop("checked") != true) {
                $("#DeEnrollmentStatusDiv" + id).show();
                $("#LiasonTranslatorDiv" + id).hide();
            } else {
                $("#DeEnrollmentStatusDiv" + id).hide();
                       $("#LiasonTranslatorDiv" + id).show();
            }
        }
        }

        $("#careplan").click(function () {

            $("#sign").find("img").addClass("sign");
        })
        $("#hide-carePlan").click(function () {
            $("#sign").find("img").removeClass("sign");
        })
    </script>
    <script src="~/Content/PatientDeatil/ProgressBar.js"></script>



}
<head>
    <title>How to use Toastr</title>
    <!-- jQuery -->
    <!-- Toastr -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <!-- Styles -->
    <style type="text/css">



        #success {
            background: green;
        }

        #error {
            background: red;
        }

        #warning {
            background: coral;
        }

        #info {
            background: cornflowerblue;
        }

        #question {
            background: grey;
        }
    </style>
</head>
<body>


    <script type="text/javascript">
        // Default Configuration
        $(document).ready(function () {

            var val = Number($("#patientidh").val());

            var isLiason = '@User.IsInRole("Liaison")';
            if (isLiason == "True" || isLiason == "true") {
            $.ajax({
                type: "POST",
                url: "/CcmFlow/CheckAdditionProviders?patientId=" + val,
                success: function (result) {
                        debugger;
                        if (result == "NotVisited") {

                            toastr.options = {
                                'closeButton': true,
                            'debug': false,
                            'newestOnTop': false,
                            'progressBar': false,
                            'positionClass': 'toast-bottom-right',
                            'preventDuplicates': false,
                            'showDuration': false,
                            'hideDuration': false,
                            'timeOut': false,
                            'extendedTimeOut': false,
                            'showEasing': 'swing',
                            'hideEasing': 'linear',
                            'showMethod': 'fadeIn',
                            'hideMethod': 'fadeOut',
                            'margin-top': '200px',
                        }



                            toastr.info('Please Update Additional Provider for this Patient')

                    }



                    },
                error: function () {


                    }

                });
            $.ajax({
                type: "POST",
                url: "/CcmFlow/CheckHospitalVisit?patientId=" + val,
                success: function (result) {
                        debugger;
                        if (result == "NotVisited") {

                            toastr.options = {
                                'closeButton': true,
                            'debug': false,
                            'newestOnTop': false,
                            'progressBar': false,
                            'positionClass': 'toast-bottom-right',
                            'preventDuplicates': false,
                            'showDuration': false,
                            'hideDuration': false,
                            'timeOut': false,
                            'extendedTimeOut': false,
                            'showEasing': 'swing',
                            'hideEasing': 'linear',
                            'showMethod': 'fadeIn',
                            'hideMethod': 'fadeOut',
                            'margin-top': '200px',
                            'background-color':'#fffff'
                            }



                            toastr.info('Please Update Hospital Visit for this Patient')

                    }



                    },
                error: function () {


                    }

                });



            }
        });

        // Toast Type
        $('#success').click(function (event) {
            toastr.success('You clicked Success toast');
        });
        $('#info').click(function (event) {

        });
        $('#error').click(function (event) {
            toastr.error('You clicked Error Toast')
        });
        $('#warning').click(function (event) {
            toastr.warning('You clicked Warning Toast')
        });

        // Toast Image and Progress Bar
        $('#image').click(function (event) {
            toastr.options.progressBar = true,
                toastr.info('<img src="https://image.flaticon.com/icons/svg/34/34579.svg" style="width:150px;">', 'Toast Image')
        });


        // Toast Position
        $('#position').click(function (event) {
            var pos = $('input[name=position]:checked', '#positionForm').val();
            toastr.options.positionClass = "toast-" + pos;
            toastr.options.preventDuplicates = false;
            toastr.info('This sample position', 'Toast Position')
        });
    </script>
</body>
